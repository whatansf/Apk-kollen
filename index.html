<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>APK‚Äëkollen ‚Äì Mest alkohol per krona p√• Systembolaget</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="S√∂k och j√§mf√∂r Systembolagets drycker efter alkohol per krona (APK). Filtrera p√• typ, pris, procent och spara favoriter. Enkel och mobilv√§nlig lista.">

  <style>
    :root {
      --bg: #0b0f14;
      --card: #111827;
      --muted: #9ca3af;
      --accent: #22c55e;
      --border: #1f2937;
      --text: #e5e7eb;
      --high-apk: #22c55e;
      --med-apk: #facc15;
      --low-apk: #ef4444;
    }

    body.light {
      --bg: #f5f7fa;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #22c55e;
      --border: #d1d5db;
      --text: #111827;
    }

    body {
      margin:0;
      padding:1rem;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      transition: background .25s, color .25s;
    }

    h1{text-align:center;margin-bottom:.2rem;letter-spacing:1px;}
    .small{text-align:center;color:var(--muted);margin-bottom:.4rem;font-size:.9rem;}
    .legend{text-align:center;font-size:.85rem;color:var(--muted);margin-bottom:1rem;}
    .legend span{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:4px;vertical-align:middle;}

    .controls{display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin-bottom:1rem;}
    input, select, button{padding:.45rem .6rem;font-size:.85rem;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--text);}
    button{cursor:pointer;transition:all .2s;}
    button:hover{border-color:var(--accent);color:var(--accent);}
    .theme-btn{font-size:1rem;padding:.45rem .7rem;transition: transform .2s ease;}
    .theme-btn:hover{transform: rotate(15deg) scale(1.1);}

    .product-list{max-width:1100px;margin:0 auto;display:flex;flex-direction:column;gap:.5rem;}
    .product-item{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:.6rem .8rem;display:flex;justify-content:space-between;align-items:center;transition: transform .15s, box-shadow .15s;}
    .product-item:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,.25);}
    .product-info{display:flex;flex-direction:column;gap:.25rem;font-size:.9rem;}
    .apk-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px;}
    .badge{background:rgba(255,255,255,.08);padding:.15rem .4rem;border-radius:4px;font-size:.75rem;width:fit-content;}
    .fav{cursor:pointer;color:#6b7280;margin-right:.4rem;font-size:1.1rem;}
    .fav.active{color:#ef4444;}
    .link a{color:var(--accent);text-decoration:none;}
    .link a:hover{text-decoration:underline;}
    .pagination{margin-top:1rem;display:flex;justify-content:center;gap:.5rem;font-size:.85rem;}
  </style>
</head>
<body>
  <h1>APK‚Äëkollen</h1>
  <div class="small">Mest alkohol per krona ‚Äì Systembolagets sortiment</div>
  <div class="legend">APK:
    <span style="background:var(--high-apk)"></span> H√∂g
    <span style="background:var(--med-apk)"></span> Medium
    <span style="background:var(--low-apk)"></span> L√•g
  </div>

  <div class="controls">
    <input id="search" placeholder="S√∂k namn">
    <select id="typeFilter"><option value="">Alla typer</option></select>
    <input id="minPrice" type="number" placeholder="Min pris">
    <input id="maxPrice" type="number" placeholder="Max pris">
    <input id="minAbv" type="number" step="0.1" placeholder="Min %">
    <select id="topMode">
      <option value="all">Alla</option>
      <option value="favorites">Favoriter</option>
    </select>
    <button onclick="resetFilters()">√Öterst√§ll</button>
    <button class="theme-btn" onclick="toggleTheme()">‚òÄÔ∏è</button>
  </div>

  <div class="product-list" id="productList"></div>

  <div class="pagination">
    <button onclick="prevPage()">‚¨Ö</button>
    <span id="pageInfo"></span>
    <button onclick="nextPage()">‚û°</button>
  </div>

<script>
/* ========================= THEME ========================== */
if(localStorage.getItem("dark")===null){
  document.body.classList.add("dark");
  localStorage.setItem("dark","true");
}else if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}

function toggleTheme(){
  document.body.classList.toggle("light");
  document.querySelector(".theme-btn").textContent =
    document.body.classList.contains("light") ? "üåô" : "‚òÄÔ∏è";
}

/* ========================= DATA ========================== */
const DATA_URL="const DATA_URL = "https://apkollen.se/api/products";  // F√§rsk fr√•n APKollen, perfekt match
let drinks=[], filtered=[], page=1, pageSize=20;
const favorites = new Set(JSON.parse(localStorage.getItem("favorites")||"[]"));

const apk=d=> (d.abv*d.volume)/d.price;

function toggleFavorite(id){
  favorites.has(id)?favorites.delete(id):favorites.add(id);
  localStorage.setItem("favorites",JSON.stringify([...favorites]));
  render();
}

function itemHTML(d){
  const a=apk(d);
  const c=a>0.1?"--high-apk":a>0.05?"--med-apk":"--low-apk";
  return `<div class="product-item">
    <div class="product-info">
      <span><span class="apk-dot" style="background:var(${c})"></span>${d.name}</span>
      <span class="badge">${d.type}</span>
      <span>${d.price} kr | ${d.abv}% | ${d.volume} l | APK ${a.toFixed(4)}</span>
    </div>
    <div>
      <span class="fav ${favorites.has(d.id)?"active":""}" onclick="toggleFavorite('${d.id}')">‚òÖ</span>
      <span class="link"><a href="https://www.systembolaget.se/produkt/${d.id}" target="_blank">Systembolaget</a></span>
    </div>
  </div>`;
}

function render(){
  const list=document.getElementById("productList");
  list.innerHTML="";
  const slice=filtered.slice((page-1)*pageSize,page*pageSize);
  slice.forEach(d=>list.innerHTML+=itemHTML(d));
  document.getElementById("pageInfo").textContent=
    `Sida ${page} / ${Math.ceil(filtered.length/pageSize)} (${filtered.length})`;
}

function apply(){
  const q=search.value.toLowerCase();
  filtered=drinks.filter(d=>{
    if(q && !d.name.toLowerCase().includes(q))return false;
    if(typeFilter.value && d.type!==typeFilter.value)return false;
    if(minPrice.value && d.price<minPrice.value)return false;
    if(maxPrice.value && d.price>maxPrice.value)return false;
    if(minAbv.value && d.abv<minAbv.value)return false;
    if(topMode.value==="favorites" && !favorites.has(d.id))return false;
    return true;
  }).sort((a,b)=>apk(b)-apk(a));
  page=1; render();
}

function resetFilters(){
  search.value=minPrice.value=maxPrice.value=minAbv.value="";
  typeFilter.value=""; topMode.value="all"; apply();
}

function nextPage(){ if(page*pageSize<filtered.length){page++;render();}}
function prevPage(){ if(page>1){page--;render();}}

async function load(){
  const res=await fetch(DATA_URL);
  const data=await res.json();
  const types=new Set();
  drinks=data.map(d=>{
    const p=parseFloat(d.price);
    const a=parseFloat(d.alcoholPercentage);
    const v=parseFloat(d.volume)/1000;
    if(!p||!a||!v)return null;
    const t=d.categoryLevel1||"Ok√§nt";
    types.add(t);
    return {id:d.productId,name:d.productNameBold||d.productNameThin,type:t,price:p,abv:a,volume:v};
  }).filter(Boolean);
  typeFilter.innerHTML='<option value="">Alla typer</option>';
  [...types].sort().forEach(t=>{
    const o=document.createElement("option");
    o.value=o.textContent=t;
    typeFilter.appendChild(o);
  });
  filtered=[...drinks];
  apply();
}

["search","typeFilter","minPrice","maxPrice","minAbv","topMode"]
.forEach(id=>document.getElementById(id).addEventListener("input",apply));

load();
</script>
</body>
</html>
